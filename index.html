<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<title>全部撤回-百家号</title>
</head>
<body>
	用户ID号：<input id="appid" style="width:300px"/> 
	TOKEN：<input id="token" style="width:300px"/>
	第<input id="p_no" style="width:30px"/>页
	<button id="but" onclick="chehuis()">一键撤回（一次最多20条）</button><hr>
	撤回结果如下：<hr>
	<div id="dataid"></div>
</body>
<script type="text/javascript">
function chehuis(){
	$("#but").attr("disabled", true);
	var pId = $("#appid").val();
	var pToken = $("#token").val();
	var pNo = $("#p_no").val();
	if(pId != ''){
		//接口-获取撤回数据
        $.ajax({
			type: "POST",
			url: "https://baijiahao.baidu.com/builderinner/open/resource/query/articleListall",
			dataType: 'json',
			async: false, 
			data: {app_id:pId, app_token:pToken, page_size:20, page_no:pNo},
			success:function(data){
				if(data.data != null){
					var msg = "";
					var count = 0;
					$.each(data.data.items,function(idx,obj){
						msg = msg + withdraw(pId, pToken, obj.article_id) + "|——>" + obj.title + "</br>";
						count++;
		　　		});
					$("#dataid").html(msg + "<hr>共计处理" + count + "条");
				}else{
					$("#dataid").html("<font color='red'>请输入正确的ID和TOKEN!<font>");
				}
		   }
		})
	} else {
		alert("请输入用户ID号！");
	}
	$("#but").attr("disabled", false);
}

//接口-执行撤回
function withdraw(pId, pToken, pArticle){
	var msg = "";
	$.ajax({
		type: "POST",
		url: "https://baijiahao.baidu.com/builderinner/open/resource/article/withdraw",
		dataType: 'json',
		async: false, 
		data: {app_id:pId, app_token:pToken, article_id:pArticle},
		success: function (data) {
			msg = data.errmsg;
		}
	});
	return msg;
}
</script>
</html>